<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>LiveLogViewer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 120 120%22><text y=%2290%22 font-size=%22100%22>ðŸ“„</text></svg>">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background: #181c20;
      min-height: 100vh;
      font-family: 'Segoe UI', Arial, sans-serif;
      overflow-x: hidden;
    }
    header {
      padding: 2rem 0 1rem 0;
      background: #23272b;
      box-shadow: 0 1px 16px 0 #14171b36;
      text-align: center;
      margin-bottom: 0;
    }
    header h1 {
      font-weight: 800;
      font-size: 2.1rem;
      letter-spacing: -1px;
      margin: 0;
      color: #5ad1f7;
      text-shadow: 0 2px 24px #09223b66;
    }
    main {
      width: 100vw !important;
      max-width: 100vw !important;
      padding-left: 0 !important;
      padding-right: 0 !important;
      margin: 0 auto;
    }
    .container-fluid {
      padding-left: 0 !important;
      padding-right: 0 !important;
      margin-left: 0 !important;
      margin-right: 0 !important;
      max-width: 100vw !important;
      width: 100vw !important;
    }
    .row, .col {
      margin: 0 !important;
      padding: 0 !important;
    }
    .panel-titulo {
      font-size: 1.22em;
      color: #5ad1f7;
      font-weight: 600;
      margin-bottom: .2em;
      margin-top: .6em;
      letter-spacing: .02em;
    }
    .panel-desc {
      color: #c5e6fa;
      font-size: 0.98em;
      margin-bottom: .4em;
      opacity: .75;
    }
    .panel {
      background: #21252b;
      border-radius: 14px;
      padding: 1.1em 1.2em 1.2em 1.2em;
      margin-bottom: 1em;
      margin-top: .8em;
      box-shadow: 0 2px 8px #101a2150;
    }
    .btn-log {
      font-size: 1em;
      font-weight: 500;
      border-radius: 7px;
      padding: .36em 1em;
      margin-right: 0.5em;
      margin-bottom: .45em;
      border: none;
      transition: background .18s, color .16s;
      background: #23272b;
      color: #38e6ff;
      box-shadow: 0 1px 6px #0de3ff11;
      display: inline-flex;
      align-items: center;
      gap: .45em;
    }
    .btn-log svg {
      width: 1.12em; height: 1.12em;
      vertical-align: middle;
    }
    .btn-log:hover {
      background: #3beaff33;
      color: #0dbd76;
    }
    .btn-live {
      font-size: 1em;
      font-weight: 500;
      border-radius: 7px;
      padding: .36em 1.12em;
      margin-bottom: .45em;
      border: none;
      transition: background .17s, color .14s;
      background: #263041;
      color: #38e6ff;
      box-shadow: 0 1px 8px #10e0ff19;
      display: inline-flex;
      align-items: center;
      gap: .49em;
      position: relative;
      cursor: pointer;
      user-select: none;
      margin-right: .8em;
    }
    .btn-live.active {
      background: linear-gradient(90deg, #13e373 60%, #2dfbad 120%);
      color: #ffffff;
      box-shadow: 0 2px 16px #0ab46740;
    }
    .btn-live:focus {
      outline: 2px solid #38e6ff;
    }
    .btn-live .info-tooltip {
      margin-left: 10px;
      margin-right: 0;
    }
    .form-control,
    .form-control-sm {
      background: #16191e;
      color: #b0eaff;
      border: 1px solid #263041;
      border-radius: 8px;
    }
    .form-control:focus {
      background: #212633;
      color: #fff;
    }
    .form-control-color {
      min-width: 36px;
      min-height: 36px;
      border-radius: 8px;
      border: none;
    }
    .btn-primary {
      background: linear-gradient(90deg,#1d6fc0 60%, #5ad1f7 120%);
      color: #fff;
      border: none;
      font-weight: 600;
    }
    .btn-primary:hover {
      background: linear-gradient(90deg,#5ad1f7 40%, #1d6fc0 100%);
      color: #181c20;
    }
    .btn-del {
      background: transparent !important;
      color: #ff3b56 !important;
      border: none;
      padding: 0.13em 0.4em !important;
      border-radius: 50%;
      margin-left: 0.5em;
      font-size: 1.19em;
      font-weight: 700;
      display: flex;
      align-items: center;
      line-height: 1;
      box-shadow: none;
      transition: background .17s;
    }
    .btn-del:hover {
      background: #ffb0bb1a !important;
      color: #d31326 !important;
      box-shadow: 0 2px 8px #ff3b5618;
    }
    .btn-del svg {
      display: block;
      vertical-align: middle;
      width: 1.17em;
      height: 1.17em;
      pointer-events: none;
    }
    .rule-tag {
      display: inline-flex;
      align-items: center;
      background: #283241;
      border-radius: 16px;
      padding: 0.15em 1.2em 0.15em 0.7em;
      font-size: 1em;
      margin-bottom: 0.2em;
      box-shadow: 0 2px 8px #1d6fc022;
      color: #b0eaff;
      position: relative;
      margin-right: 0.6em;
    }
    .rule-color {
      display: inline-block;
      width: 16px;
      height: 16px;
      margin-right: .6em;
      border-radius: 8px;
      border: 1px solid #fff3;
      box-shadow: 0 1px 3px #1118;
      vertical-align: middle;
    }
    .log-card {
      background: #15171c;
      border-radius: 0;
      box-shadow: 0 2px 16px #3ed7ff10;
      padding: 1.1em 0.6em;
      font-family: "Fira Mono", "Consolas", monospace;
      font-size: 1.08em;
      color: #e2f2ff;
      line-height: 1.55;
      overflow-x: auto;
      overflow-y: auto;
      min-height: 74vh;
      height: 84vh;
      max-height: 88vh;
      width: 100vw;
      white-space: pre;
      margin-bottom: 1em;
      transition: box-shadow .16s;
      border-radius: 0;
    }
    .log-row {
      padding: 0.07em 0.4em;
      border-radius: 5px;
      transition: background .15s, color .13s;
      width: fit-content;
      min-width: 100%;
      display: block;
    }
    .corner-logos {
      position: fixed;
      bottom: 24px;
      right: 28px;
      z-index: 1000;
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    .corner-logo-link {
      background: #21252b;
      border-radius: 50%;
      width: 46px;
      height: 46px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 12px #0005;
      transition: background .17s, transform .14s;
      opacity: 0.90;
      border: 1.5px solid #283345;
    }
    .corner-logo-link:hover {
      background: #5ad1f7;
      transform: scale(1.13) rotate(-7deg);
      opacity: 1.0;
      border-color: #61dafb;
    }
    .corner-logo-link svg {
      width: 26px;
      height: 26px;
      display: block;
      transition: fill .16s;
    }
    .corner-logo-link.github svg { fill: #f5f6fa;}
    .corner-logo-link.linkedin svg { fill: #1da1f2;}
    .corner-logo-link:hover.github svg { fill: #171515;}
    .corner-logo-link:hover.linkedin svg { fill: #0077b5;}
    ::placeholder { color: #f6fafd !important; opacity:1;}
    /* Pantalla completa log */
    .fullscreen-btn {
      background: transparent;
      border: none;
      color: #73d6ff;
      border-radius: 5px;
      font-size: 1.4em;
      margin-left: 8px;
      padding: 2px 7px 2px 7px;
      display: flex;
      align-items: center;
      cursor: pointer;
      transition: background .16s;
    }
    .fullscreen-btn:hover, .fullscreen-btn.active {
      background: #2b3557;
      color: #34f6cb;
    }
    .fullscreen-target:fullscreen,
    .fullscreen-target:-webkit-full-screen {
      background: #15171c;
      z-index: 9999;
      width: 100vw !important;
      height: 100vh !important;
      min-height: 100vh !important;
      max-height: none !important;
      border-radius: 0 !important;
      box-shadow: none !important;
      position: fixed !important;
      left: 0; top: 0;
      right: 0; bottom: 0;
      margin: 0 !important;
      padding: 0 !important;
    }
    .fullscreen-target:fullscreen .log-row,
    .fullscreen-target:-webkit-full-screen .log-row {
      font-size: 1.23em !important;
      min-width: 100vw;
    }
    .fullscreen-target:fullscreen::-webkit-scrollbar,
    .fullscreen-target:-webkit-full-screen::-webkit-scrollbar {
      width: 16px;
      background: #222d3b;
    }
    .fullscreen-target:fullscreen::-webkit-scrollbar-thumb,
    .fullscreen-target:-webkit-full-screen::-webkit-scrollbar-thumb {
      background: #5ad1f7;
    }
    .info-tooltip {
      display: inline-block;
      position: relative;
      cursor: pointer;
      margin-right: 0;
    }
    .info-tooltip svg {
      filter: drop-shadow(0 2px 6px #41c7ff33);
      transition: filter .13s;
    }
    .info-tooltip:focus svg,
    .info-tooltip:hover svg {
      filter: drop-shadow(0 0 4px #51fcfc55);
    }
    .info-tooltip-content {
      display: none;
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      background: #232f41;
      color: #b0eaff;
      border-radius: 10px;
      padding: 11px 16px;
      font-size: 0.99em;
      box-shadow: 0 4px 24px #181e2675;
      z-index: 100;
      min-width: 250px;
      max-width: 320px;
      white-space: normal;
      pointer-events: none;
      opacity: 0;
      transition: opacity .17s;
      top: 140%;
      text-align: left;
      font-weight: 400;
    }
    .info-tooltip:hover .info-tooltip-content,
    .info-tooltip:focus .info-tooltip-content,
    .info-tooltip.active .info-tooltip-content {
      display: block;
      opacity: 1;
      pointer-events: auto;
    }
    @media (max-width:600px) {
      .corner-logos { right: 8px; bottom: 8px; gap: 10px;}
      .corner-logo-link {width: 38px; height: 38px;}
      .corner-logo-link svg {width: 20px; height: 20px;}
      .fullscreen-btn { font-size:1.18em; padding:2px 7px;}
      .btn-live {padding: .28em 0.5em; font-size:.97em;}
      .info-tooltip-content {
        left: 0;
        transform: none;
        min-width: 180px;
        max-width: 88vw;
        font-size: .97em;
      }
    }
    ::selection { background: #4be1ff55; }
  </style>
</head>
<body>
  <header>
    <h1>LiveLogViewer</h1>
  </header>
  <main class="container-fluid">
    <div class="panel">
      <div class="panel-titulo">1. Abrir archivo de log (modo en vivo, solo Chromium)</div>
      <div class="panel-desc">
        Solo funciona en <b>Chrome, Edge, Opera o Brave</b>. Accede al archivo real en disco, mostrando cambios en tiempo real.<br>
        <b>Selecciona el archivo:</b>
      </div>
      <div class="d-flex flex-wrap align-items-center mb-2 gap-2">
        <button class="btn-log" id="btnOpenLog">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="currentColor" d="M2.5 3A1.5 1.5 0 0 1 4 1.5h5a.5.5 0 0 1 .5.5v2a.5.5 0 0 0 .5.5h2a.5.5 0 0 1 .5.5v7.5A1.5 1.5 0 0 1 11.5 14h-7A1.5 1.5 0 0 1 3 12.5v-9Zm1.5-.5a.5.5 0 0 0-.5.5v9A.5.5 0 0 0 4 13h7.5a.5.5 0 0 0 .5-.5V5h-1.5A1.5 1.5 0 0 1 9 3.5V2H4Zm5.5.207V3a.5.5 0 0 0 .5.5h.793L9 2.207Z"/></svg>
          Abrir log
        </button>
        <span id="liveStatus" style="color:#0dbd76;font-size:.98em;display:none;">Log abierto en vivo</span>
        <input type="checkbox" id="autoReloadChk" style="display:none;">
        <button type="button" id="btnLive" class="btn-live" tabindex="0" aria-pressed="false">
          Log en vivo
          <span class="info-tooltip" tabindex="0">
            <svg viewBox="0 0 18 18" width="1em" height="1em" fill="none" style="vertical-align:-2px;display:inline-block;">
              <circle cx="9" cy="9" r="8" fill="#36c2ff" stroke="#81e4ff" stroke-width="1.5"/>
              <rect x="8.15" y="7.15" width="1.7" height="5.3" rx="0.85" fill="#fff"/>
              <rect x="8.15" y="4.2" width="1.7" height="1.7" rx="0.85" fill="#fff"/>
            </svg>
            <span class="info-tooltip-content">
              Actualiza automÃ¡ticamente el log cada 2 segundos.<br>
              <b>En pantalla completa</b> puedes activar/desactivar con la tecla <b>ESPACIO</b>.
            </span>
          </span>
        </button>
      </div>
      <div class="panel-titulo mt-3">2. Filtrar texto (opcional)</div>
      <div class="panel-desc">
        Escribe una palabra, frase o expresiÃ³n regular. Solo se mostrarÃ¡n las lÃ­neas que coincidan.
      </div>
      <input type="search" id="searchInput" class="form-control"
        placeholder="Ej: ERROR, 192.168., ^[INFO]" oninput="showLog()" autocomplete="off" />
    </div>
    <div class="panel">
      <div class="panel-titulo">3. Crear reglas de colores</div>
      <div class="panel-desc">
        Define reglas para resaltar lÃ­neas segÃºn palabras o patrones.
      </div>
      <div class="d-flex flex-wrap align-items-center mb-2 gap-2">
        <input type="text" class="form-control form-control-sm" style="max-width: 220px;"
          id="pattern" placeholder="Ej: [ERROR], conectado, timeout|fail" />
        <input type="color" class="form-control form-control-color" id="color" value="#ff3333" title="Elegir color"/>
        <button class="btn btn-primary btn-sm" onclick="addRule()">Agregar regla</button>
      </div>
      <div class="mt-2">
        <span class="fw-semibold" style="color:#5ad1f7;">Reglas activas:</span>
        <div id="rulesList" class="mb-2 mt-1"></div>
      </div>
    </div>
    <div id="logMetaBar" class="d-flex justify-content-between align-items-center px-3 py-2 mb-1"
      style="background:#212933;border-radius:10px 10px 0 0; color:#88eaff; font-size:1.06em; font-weight:500; min-height:36px; display:none;">
      <div>
        <span id="linesCount">0 lÃ­neas</span>
      </div>
      <div class="d-flex align-items-center gap-2">
        <span id="fileDate"></span>
        <button id="fullscreenBtn" class="fullscreen-btn" title="Pantalla completa" style="display:none;">
          <span id="fullscreenIcon">
            <svg width="1em" height="1em" viewBox="0 0 18 18" fill="none">
              <path d="M2 6V3a1 1 0 0 1 1-1h3M16 6V3a1 1 0 0 0-1-1h-3M2 12v3a1 1 0 0 0 1 1h3M16 12v3a1 1 0 0 1-1 1h-3"
                stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
            </svg>
          </span>
          <span id="fullscreenExitIcon" style="display:none;">
            <svg width="1em" height="1em" viewBox="0 0 18 18" fill="none">
              <path d="M7 11v3a1 1 0 0 1-1 1H3M11 11v3a1 1 0 0 0 1 1h3M7 7V4a1 1 0 0 0-1-1H3M11 7V4a1 1 0 0 1 1-1h3"
                stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
            </svg>
          </span>
        </button>
      </div>
    </div>
    <div class="row gx-0">
      <div class="col-12">
        <div id="logDisplay" class="log-card w-100 fullscreen-target" tabindex="0">Carga un log para comenzar.</div>
      </div>
    </div>
  </main>
  <div class="corner-logos">
    <a class="corner-logo-link github" href="https://github.com/alexsf93" target="_blank" rel="noopener" aria-label="GitHub de Alejandro">
      <svg viewBox="0 0 24 24"><path d="M12 .297c-6.6 0-12 5.403-12 12.077 0 5.328 3.438 9.857 8.207 11.463.6.113.793-.263.793-.582 0-.288-.012-1.243-.017-2.253-3.338.734-4.042-1.612-4.042-1.612-.546-1.393-1.333-1.764-1.333-1.764-1.088-.763.083-.748.083-.748 1.205.086 1.839 1.237 1.839 1.237 1.07 1.868 2.809 1.329 3.495 1.017.108-.787.418-1.329.762-1.635-2.665-.309-5.466-1.36-5.466-6.051 0-1.337.465-2.431 1.235-3.288-.123-.31-.535-1.556.117-3.244 0 0 1.007-.326 3.3 1.254A11.267 11.267 0 0 1 12 6.844c1.02.005 2.047.138 3.008.404 2.291-1.58 3.297-1.254 3.297-1.254.653 1.688.241 2.934.119 3.244.77.857 1.234 1.951 1.234 3.288 0 4.703-2.805 5.739-5.477 6.043.43.372.823 1.102.823 2.222 0 1.606-.014 2.902-.014 3.293 0 .322.192.699.8.58C20.565 22.229 24 17.7 24 12.374c0-6.674-5.4-12.077-12-12.077z"/></svg>
    </a>
    <a class="corner-logo-link linkedin" href="https://www.linkedin.com/in/alejandro-su%C3%A1rez-fern%C3%A1ndez/" target="_blank" rel="noopener" aria-label="LinkedIn de Alejandro">
      <svg viewBox="0 0 24 24"><path d="M20.447 20.452h-3.554v-5.569c0-1.327-.025-3.037-1.852-3.037-1.853 0-2.135 1.445-2.135 2.939v5.667H9.354V9h3.414v1.561h.049c.476-.899 1.637-1.85 3.369-1.85 3.601 0 4.266 2.368 4.266 5.455v6.286zM5.337 7.433c-1.144 0-2.069-.926-2.069-2.069 0-1.143.925-2.069 2.069-2.069 1.143 0 2.069.926 2.069 2.069 0 1.143-.926 2.069-2.069 2.069zm1.777 13.019H3.561V9h3.553v11.452z"/></svg>
    </a>
  </div>
  <script>
    let logLines = [];
    let rules = [
      { pattern: '\\[ERROR\\]', color: '#ff3333' },
      { pattern: '\\[INFO\\]',  color: '#33aaff' },
      { pattern: '\\[OK\\]',    color: '#34c759' }
    ];
    let liveFileHandle = null;
    let autoReloadTimer = null;
    let lastModified = null;

    function renderRules() {
      const box = document.getElementById('rulesList');
      box.innerHTML = '';
      rules.forEach((r, i) => {
        const tag = document.createElement('span');
        tag.className = 'rule-tag';
        tag.innerHTML = `<span class="rule-color" style="background:${r.color}"></span>
        <b>${r.pattern}</b>
        <button class="btn-del" onclick="delRule(${i})" title="Eliminar">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor"><path d="M12.146 3.854a.5.5 0 0 1 0 .708L8.707 8l3.439 3.438a.5.5 0 0 1-.708.708L8 8.707l-3.438 3.439a.5.5 0 0 1-.708-.708L7.293 8 3.854 4.562a.5.5 0 1 1 .708-.708L8 7.293l3.438-3.439a.5.5 0 0 1 .708 0z"/></svg>
        </button>`;
        box.appendChild(tag);
      });
    }

    function addRule() {
      const pattern = document.getElementById('pattern').value.trim();
      const color = document.getElementById('color').value;
      if (pattern) {
        rules.push({ pattern, color });
        renderRules();
        showLog();
        document.getElementById('pattern').value = '';
      }
    }

    function delRule(idx) {
      rules.splice(idx, 1);
      renderRules();
      showLog();
    }

    document.getElementById('btnOpenLog').addEventListener('click', async function() {
      if (!window.showOpenFilePicker) {
        alert('Tu navegador no soporta el modo "log en vivo". Prueba en Chrome, Edge, Opera o Brave.');
        return;
      }
      try {
        const [handle] = await window.showOpenFilePicker({
          types: [{ description: 'Archivos de Log', accept: { 'text/plain': ['.log', '.txt'] } }]
        });
        if (handle) {
          liveFileHandle = handle;
          document.getElementById('liveStatus').style.display = 'inline';
          document.getElementById('liveStatus').innerText = 'Log abierto: ' + (handle.name || 'Archivo log');
          readLiveFile();
          if (document.getElementById('autoReloadChk').checked) startAutoReload();
        }
      } catch (e) {
        if (e.name !== 'AbortError') {
          alert('No se pudo abrir el archivo: ' + (e.message || e));
        }
      }
    });

    async function readLiveFile() {
      if (!liveFileHandle) return;
      try {
        const file = await liveFileHandle.getFile();
        lastModified = file.lastModified;
        const text = await file.text();
        logLines = text.split('\n');
        showLog();
      } catch (e) {
        alert('No se pudo leer el archivo: ' + (e.message || e));
      }
    }

    function startAutoReload() {
      stopAutoReload();
      autoReloadTimer = setInterval(() => {
        if (liveFileHandle) readLiveFile();
      }, 2000);
    }
    function stopAutoReload() {
      if (autoReloadTimer) clearInterval(autoReloadTimer);
      autoReloadTimer = null;
    }
    document.getElementById('autoReloadChk').addEventListener('change', function(e) {
      if (e.target.checked && liveFileHandle) startAutoReload();
      else stopAutoReload();
    });

    function escapeHTML(str) {
      return str.replace(/[<>&"]/g, function(c) {
        return {'<':'&lt;','>':'&gt;','&':'&amp;','"':'&quot;'}[c];
      });
    }

    function showLog() {
      const logDisplay = document.getElementById('logDisplay');
      const metaBar = document.getElementById('logMetaBar');
      const linesCount = document.getElementById('linesCount');
      const fileDate = document.getElementById('fileDate');
      let shownLines = 0;
      if (!logLines.length) {
        logDisplay.innerText = 'Carga un log para comenzar.';
        metaBar.style.display = 'none';
        return;
      }
      metaBar.style.display = 'flex';
      let html = '';
      const searchVal = document.getElementById('searchInput').value.trim();
      let regexSearch = null;
      if (searchVal) {
        try { regexSearch = new RegExp(searchVal, 'i'); } catch (e) {}
      }
      for (let line of logLines) {
        let matched = false;
        if (regexSearch && !regexSearch.test(line)) continue;
        for (let rule of rules) {
          try {
            if (new RegExp(rule.pattern, 'i').test(line)) {
              html += `<div class="log-row" style="background:${rule.color}; color:#222;">${escapeHTML(line)}</div>`;
              matched = true;
              break;
            }
          } catch(e) {}
        }
        if (!matched) html += `<div class="log-row">${escapeHTML(line)}</div>`;
        shownLines++;
      }
      logDisplay.innerHTML = html || 'No hay lÃ­neas para mostrar.';
      linesCount.innerText = shownLines + (shownLines === 1 ? ' lÃ­nea' : ' lÃ­neas');
      if (lastModified) {
        const date = new Date(lastModified);
        fileDate.innerText = 'Ãšltima modificaciÃ³n: ' + date.toLocaleString();
      } else {
        fileDate.innerText = '';
      }
      if (document.getElementById('autoReloadChk').checked) {
        scrollLogToBottom();
      }
    }

    function scrollLogToBottom() {
      const logDisplay = document.getElementById('logDisplay');
      logDisplay.scrollTop = logDisplay.scrollHeight;
    }

    const logDisplay = document.getElementById('logDisplay');
    const fullscreenBtn = document.getElementById('fullscreenBtn');
    const fullscreenIcon = document.getElementById('fullscreenIcon');
    const fullscreenExitIcon = document.getElementById('fullscreenExitIcon');
    if (document.fullscreenEnabled || document.webkitFullscreenEnabled) {
      fullscreenBtn.style.display = "flex";
    }
    fullscreenBtn.addEventListener('click', () => {
      if (!document.fullscreenElement && !document.webkitFullscreenElement) {
        if (logDisplay.requestFullscreen) logDisplay.requestFullscreen();
        else if (logDisplay.webkitRequestFullscreen) logDisplay.webkitRequestFullscreen();
      } else {
        if (document.exitFullscreen) document.exitFullscreen();
        else if (document.webkitExitFullscreen) document.webkitExitFullscreen();
      }
    });
    function updateFullscreenBtn() {
      if (document.fullscreenElement === logDisplay || document.webkitFullscreenElement === logDisplay) {
        fullscreenBtn.classList.add("active");
        fullscreenIcon.style.display = "none";
        fullscreenExitIcon.style.display = "";
      } else {
        fullscreenBtn.classList.remove("active");
        fullscreenIcon.style.display = "";
        fullscreenExitIcon.style.display = "none";
      }
    }
    document.addEventListener("fullscreenchange", updateFullscreenBtn);
    document.addEventListener("webkitfullscreenchange", updateFullscreenBtn);
    logDisplay.addEventListener('keydown', function(e) {
      if ((e.key === "Escape" || e.key === "Esc") &&
         (document.fullscreenElement === logDisplay || document.webkitFullscreenElement === logDisplay)) {
        if (document.exitFullscreen) document.exitFullscreen();
        else if (document.webkitExitFullscreen) document.webkitExitFullscreen();
      }
    });

    // ------ LOG EN VIVO COMO BOTÃ“N ------
    const btnLive = document.getElementById('btnLive');
    const chkLive = document.getElementById('autoReloadChk');
    function updateLiveBtn() {
      if (chkLive.checked) {
        btnLive.classList.add('active');
        btnLive.setAttribute('aria-pressed', 'true');
      } else {
        btnLive.classList.remove('active');
        btnLive.setAttribute('aria-pressed', 'false');
      }
    }
    btnLive.addEventListener('click', function() {
      chkLive.checked = !chkLive.checked;
      chkLive.dispatchEvent(new Event('change'));
      updateLiveBtn();
      btnLive.blur();
    });
    chkLive.addEventListener('change', updateLiveBtn);
    updateLiveBtn();

    logDisplay.addEventListener('keydown', function(e) {
      if (
        (document.fullscreenElement === logDisplay || document.webkitFullscreenElement === logDisplay) &&
        (e.code === "Space" || e.key === " " || e.key === "Spacebar") &&
        document.activeElement === logDisplay
      ) {
        e.preventDefault();
        chkLive.checked = !chkLive.checked;
        chkLive.dispatchEvent(new Event('change'));
      }
    });

    function focusLogOnFullscreen() {
      if (document.fullscreenElement === logDisplay || document.webkitFullscreenElement === logDisplay) {
        setTimeout(() => { logDisplay.focus(); }, 100);
      }
    }
    document.addEventListener("fullscreenchange", focusLogOnFullscreen);
    document.addEventListener("webkitfullscreenchange", focusLogOnFullscreen);

    logDisplay.tabIndex = 0;

    document.addEventListener('DOMContentLoaded', function(){
      document.querySelectorAll('.info-tooltip').forEach(function(el){
        el.addEventListener('click', function(e){
          e.stopPropagation();
          document.querySelectorAll('.info-tooltip.active').forEach(function(ot){ if(ot!==el) ot.classList.remove('active'); });
          el.classList.toggle('active');
        });
      });
      window.addEventListener('click', function(){ 
        document.querySelectorAll('.info-tooltip.active').forEach(function(ot){ ot.classList.remove('active'); });
      });
    });

    renderRules();
  </script>
</body>
</html>
